# File Descriptions

## Root Directory Files

### Core Application Files
- **main.go** - Entry point of the application. Parses CLI flags, initializes databases, replicates selected table, and starts the proxy server
- **database.go** - Database connection logic. Contains functions for initializing connections to local and remote MySQL databases
- **query.go** - Query string builders. Returns SQL query strings for operations like SHOW TABLES, SHOW CREATE, etc.
- **view.go** - Terminal UI logic. Interactive prompts for selecting databases and tables using charmbracelet/huh
- **graph.go** - Graph algorithms for table dependencies. Performs topological sorting on foreign key relationships
- **graph_test.go** - Unit tests for graph topological sorting functions
- **sql-manipulator.go** - SQL generation for data replication. Creates INSERT statements from table schemas and data
- **sql-manipulator_test.go** - Unit tests for SQL manipulation and generation

### Testing Files
- **integration_test.go** - End-to-end integration test. Calls main() with flags and verifies table replication from remote to local DB
- **test-quick.sh** - Quick test runner script. Sets environment variables and runs integration tests (assumes Docker containers are running)
- **run-integration-tests.sh** - Full integration test suite. Starts Docker containers, runs tests, and cleans up automatically

### Docker Files
- **Dockerfile** - Docker image definition for the local (spoofed) database container
- **Dockerfile.sha2** - Alternative Dockerfile (possibly for different auth methods)
- **docker-compose.yml** - Defines two MySQL containers: localdb (port 3306) and remote db (port 3307)
- **my.cnf** - MySQL configuration file mounted into local database container
- **init.sql** - Database initialization script. Creates test schema with users, application_gates, applications, and user_types tables

### Documentation
- **README.md** - Project overview, motivation, and getting started guide
- **FILE-DESCRIPTIONS.md** - This file. Describes the purpose of each file in the project
- **INTEGRATION_TESTING.md** - Detailed integration testing guide with test cases, troubleshooting, and CI/CD examples
- **INTEGRATION_TEST_QUICKREF.md** - Quick reference for running integration tests
- **LICENSE** - Project license file

### Build Artifacts
- **go.mod** - Go module definition with dependencies
- **go.sum** - Dependency checksums for reproducible builds
- **imposter-db** - Compiled executable binary (generated by `go build`)
- **Makefile** - Build automation with targets for test, build, docker-up, docker-down, etc.

## protocol/ Directory

MySQL wire protocol implementation for proxying database connections.

### Authentication
- **auth.go** - Core authentication logic and interfaces for MySQL authentication flow
- **auth_test.go** - Unit tests for authentication logic
- **auth-switch-request.go** - Handles MySQL authentication method switching (server → client)
- **auth-switch-response.go** - Handles authentication switch responses (client → server)
- **handshake-request.go** - Parses and handles initial client handshake request packet
- **handshake-request_test.go** - Unit tests for handshake request parsing
- **handshake-response.go** - Builds and sends server handshake response packet
- **handshake-response_test.go** - Unit tests for handshake response generation

### Protocol Packets
- **packet.go** - Base packet structure and common packet handling functions (read/write)
- **packet_test.go** - Unit tests for packet reading and writing
- **ok-packet.go** - OK packet structure for indicating successful operations
- **ok-packet_test.go** - Unit tests for OK packet generation
- **err-packet.go** - Error packet structure for MySQL errors
- **query.go** - Query command packet handling and parsing
- **resultset.go** - Result set packet structures (currently minimal/unused)

### Core Proxy Logic
- **proxy.go** - Main proxy logic. Routes queries to local or remote DB based on table being queried
- **sql.go** - Connection and command phase handling. Main SQL command routing logic
- **commands.go** - MySQL protocol command constants (COM_QUERY, COM_QUIT, etc.)
- **flags.go** - MySQL protocol flag constants for capabilities, status, etc.
- **utilities.go** - Helper functions for protocol operations (byte manipulation, length encoding, etc.)

## pcapng/ Directory

Network packet captures for debugging and analysis:
- **application-with-proxy-error.pcapng** - Traffic capture showing application connection failure through proxy
- **application-wo-proxy-succes.pcapng** - Traffic capture of successful direct application connection
- **dbeaver-init-success-no-proxy.pcapng** - DBeaver connection to MySQL without proxy
- **iaraaapi-with-proxy-error.pcapng** - API connection failure through proxy
- **iaraaapi-wo-proxy-succes.pcapng** - Successful API connection without proxy
- **login-dbeaver-mysql.pcapng** - DBeaver MySQL authentication flow
- **update-dbeaver-utan5.pcapng** - DBeaver UPDATE query execution

## failed-codings/ Directory

Debugging artifacts from authentication development:
- Various `.capture` files documenting authentication decoding failures during development
- Used for troubleshooting MySQL authentication methods (caching_sha2_password, sha256_password, etc.)

## Project Structure Summary

```
imposter-db/
├── Core Application (main.go, database.go, query.go, view.go, graph.go)
├── SQL Generation (sql-manipulator.go)
├── Testing (integration_test.go, *_test.go, test scripts)
├── Docker Setup (Dockerfile, docker-compose.yml, init.sql, my.cnf)
├── Documentation (README.md, INTEGRATION_*.md, LICENSE)
├── Build Tools (go.mod, go.sum, Makefile)
├── protocol/ (MySQL wire protocol implementation)
├── pcapng/ (Network packet captures for analysis)
└── failed-codings/ (Authentication debugging artifacts)
```

## Key Workflows

### Application Startup Flow
1. **main.go** - Parse flags, init databases via database.go
2. **view.go** or flags - Select schema/table
3. **graph.go** - Determine table dependencies (if -fk flag set)
4. **query.go** + **sql-manipulator.go** - Generate replication queries
5. **database.go** - Execute replication to local DB
6. **main.go** - Start proxy server on specified port
7. **protocol/proxy.go** - Handle incoming connections

### Proxy Request Flow
1. Client connects → **protocol/handshake-*.go** handle auth
2. Client sends query → **protocol/sql.go** receives command
3. **protocol/proxy.go** determines if query is for spoofed table
4. Route to local or remote DB accordingly
5. **protocol/packet.go** sends response back to client

### Testing Flow
1. **run-integration-tests.sh** or **test-quick.sh** sets env vars
2. Starts Docker containers (if needed)
3. **integration_test.go** calls main() with test flags
4. Verifies table replication, schema, data integrity
5. Tests database isolation (local vs remote)
